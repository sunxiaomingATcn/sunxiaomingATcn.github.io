<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>单品</title>
		<link rel="stylesheet" href="css/media.css-750.css?time=2017072509.css" />
		<link rel="stylesheet" href="css/all.css?time=2017072509.css" />
		<link rel="stylesheet" href="css/suoysp.css?time=2017072509.css" />
		<link rel="stylesheet" type="text/css" href="css/footer.css?time=2017072509.css" />
		<link rel="stylesheet" href="css/swiper.css?time=2017072509.css" />
		<link rel="stylesheet" href="css/singleitem.css?time=2017072509.css" />
		<!--<style>
			#wrapper {
				overflow-y: scroll !important;
			}
		</style>-->
	</head>

	<body class="bgBody">
		<div class="loading">
			<img src="img/loading.gif" alt="" />
		</div>
		<!--头像和搜索栏-->
		<div class="header">
			<div class="hedIpBox">
				<input type="text" class="huohao" placeholder="输入您要查找的内容" /><img class="search searchShangpin" src="img/public/ss@2x.png" alt="" />
			</div>
			<div class="imgBg">
				<img src="img/public/ss@2x.png" alt="" />
			</div>
		</div>
		<div id="wrapper" class="cloBagd hideShop">
			<div id="scroller" class="appendBox">
				<div class="clo1"></div>
				<div class="clo2"></div>
				<div style="clear: both;"></div>
			</div>
		</div>
		<div id="footer"></div>

		<!--底部导航栏-->
		<div class="footer_navigation">
			<ul>
				<li class="back_more">
					<a href="index.html"><img src="img/public/more@2x.png" alt="" /></a>
				</li>
				<li class="bottom_nav">
					<img src="img/public/sysp@2x.png" alt="" />
					<span>所有商品</span>
				</li>
				<li class="back_me"><img src="img/public/onlycenter@2x.png" alt="" /></li>
			</ul>
		</div>
		</div>
		</div>

		<!--买手商城-->
		<div class="showHid" id="buyerBox">
			<div class="hand_mall">
				<!--logo 标题-->
				<div class="logo_buyahand">
					<img src="img/public/logo@2x.png" alt="" />商城
				</div>
				<!--买手区域-->
				<div class="buyers">
					<!--左边 衣服-->
					<div class="cloDec clothes">
						<div data-type="1">
							<img class="top_cloth" src="img/buyhand/jacket2@2x.png" alt="" />
							<span>上装</span>
						</div>
						<div data-type="2">
							<img class="top_cloth" src="img/buyhand/dress@2x.png" />
							<span>下装</span>
						</div>
						<div class="bottom_cloth" data-type="3">
							<img src="img/buyhand/dress4@2x.png" />
							<span>连体</span>
						</div>
					</div>
					<!--右边鞋子 装饰品-->
					<div class="cloDec decoration">
						<div data-type="4">
							<img src="img/buyhand/scarf@2x.png" />
							<span>围巾</span>
						</div>
						<div data-type="5">
							<img src="img/buyhand/bag44@2x.png" />
							<span>包</span>
						</div>
						<div data-type="6">
							<img src="img/buyhand/diamond22@2x.png" />
							<span>饰品</span>
						</div>
						<div data-type="7">
							<img src="img/buyhand/feminine3@2x.png" />
							<span>鞋</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>

	<script type="text/javascript" src="js/jquery-1.11.1.min.js?time=2017072509"></script>
	<script type="text/javascript" src="js/iscroll.js?time=2017072509"></script>
	<script src="js/all.js"></script>
	<script type="text/javascript">
		//		$(".hideShop").show(3000);
		setTimeout(function() {
			$(".loading").hide();
		}, 2000);

		//商品详情页
		var MemberId = localStorage.MemberId;
		var CategoryId = localStorage.ParentCategoryName;
		var generatedCount = 0,
			generated = 0,
			PageIndex = 1,
			pagdex = 1,
			PageSize = 10;

		var datt = localStorage.datt;
		if(datt == 1) {
			//查询某件商品
			getId();
		} else {
			//商品列表
			getCommodity();
		}
		//查询商品
		function getId() {
			var inp = localStorage.val;
			$.ajax({
				type: "post",
				//				url: "http://11.1.1.113:8888/API/Products/Product/Search",
				url: host + "/API/Products/Product/Search",
				data: {
					MemberId: MemberId,
					PageIndex: pagdex,
					U_Num: localStorage.u_num,
					number: inp
				},
				success: function(data) {
					var divFooter = '</div></div>',
						sedDivHed = '<div class="message_box"><div class="message">',
						sedDivFooter = '</div></div>';
					if(data.ResultType == '3') {
						//						console.log(inp);
						var contacts = data.Data;
						if(generated == 0 && contacts.length == 0) {
							var div = '<div class="dialog">还没有此类商品</div>';
							$(".appendBox").append(div);
						}
						$.each(data.Data, function(i, item) {
							var divHed = '<div class="white_bg" data-product-id=' + item.ProductId + ' data-ProductId=' + item.ProductId + ' data-ProductNumber=' + item.ProductNumber + '><div class="commodity">';
							var img = '<img  class="picture" src=' + item.ImagePath + ' />';
							var cost = '<p>￥' + item.Price + '</p>';
							var CategoryName = '<ul class="mold"><li>' + item.CategoryName + '</li><li>' + item.SeasonName + '</li></ul>	'
							var html = divHed + img + sedDivHed + cost + CategoryName + sedDivFooter + divFooter;
							var v1 = $(".clo1").height();
							var v2 = $(".clo2").height();
							if(v1 <= v2) {
								$(html).appendTo($(".clo1"));
							} else {
								$(html).appendTo($(".clo2"));
							}
							generated++;
						});
						$(".white_bg").bind('click', function() {
							var dataId = $(this).attr('data-product-id');
							var ProductId = $(this).attr("data-ProductId");
							var ProductNumber = $(this).attr("data-ProductNumber");
							localStorage.dataId = dataId;
							localStorage.ProductId = ProductId;
							localStorage.ProductNumber = ProductNumber;
							location.href = "xiangqing.html";
						});
					} else {
						console.log(inp);
						var div = '<div class="dialog">还没有此类商品</div>';
						$(".appendBox").append(div);
					}
				}
			});
			pagdex++;
		}

		function getCommodity() {
			$.ajax({
				type: "post",
				url: host + "/api/Products/Product/GetListByStore",
				async: true,
				data: {
					MemberId: MemberId,
					StoreId: 14,
					CategoryId: CategoryId,
					PageIndex: PageIndex,
					PageSize: PageSize,
				},
				success: function(data) {
					var divFooter = '</div></div>',
						sedDivHed = '<div class="message_box"><div class="message">',
						sedDivFooter = '</div></div>';
					if(data.ResultType == '3') {
						var contacts = data.Data;
						if(generatedCount == 0 && contacts.length == 0) {
							var div = '<div class="dialog">还没有此类商品</div>';
							$(".appendBox").append(div);
						}
						$.each(data.Data, function(i, item) {
							var divHed = '<div class="white_bg" data-product-id=' + item.ProductId + ' data-ProductId=' + item.ProductId + ' data-ProductNumber=' + item.ProductNumber + '><div class="commodity">';
							var img = '<img  class="picture" src=' + item.ImagePath + ' />';
							var cost = '<p>￥' + item.Price + '</p>';
							var CategoryName = '<ul class="mold"><li>' + item.CategoryName + '</li><li>' + item.SeasonName + '</li></ul>	'
							var html = divHed + img + sedDivHed + cost + CategoryName + sedDivFooter + divFooter;
							var v1 = $(".clo1").height();
							var v2 = $(".clo2").height();
							if(v1 <= v2) {
								$(html).appendTo($(".clo1"));
							} else {
								$(html).appendTo($(".clo2"));
							}
							generatedCount++;
						});
						$(".white_bg").bind('click', function() {
							var dataId = $(this).attr('data-product-id');
							var ProductId = $(this).attr("data-ProductId");
							var ProductNumber = $(this).attr("data-ProductNumber");
							localStorage.dataId = dataId;
							localStorage.ProductId = ProductId;
							localStorage.ProductNumber = ProductNumber;
							location.href = "xiangqing.html";
						})
					}
				}
			});
			PageIndex++;

						$(".appendBox").scroll(function() {
							var $this = $(this),
								viewH = $(this).height(), //可见高度  
								contentH = $(this).get(0).scrollHeight, //内容高度  
								scrollTop = $(this).scrollTop(); //滚动高度  						
							//if(contentH - viewH - scrollTop <= 100) { //到达底部100px时,加载新内容  
							if(scrollTop / (contentH - viewH) >= 0.98) { //到达底部100px时,加载新内容  
								getCommodity();
							}
						});
		}
		var myscroll;

		function loaded() {
			myScroll = new iScroll('wrapper', {
				hScrollbar: false,
				vScrollbar: false,
				snap: true,
				onBeforeScrollStart: function(e) {
					var target = e.target;
					while(target.nodeType != 1) target = target.parentNode;
					if(target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA') {
						e.preventDefault();
					}
				},
				onBeforeScrollMove: function(e) {
					 if (e.cancelable) {
			            // 判断默认行为是否已经被禁用
			            if (!e.defaultPrevented) {
			                e.preventDefault();
			            }
       				 }
				},
				onScrollEnd: function(e) {
					setTimeout(function() {
						if(datt == 1) {
							getId();
						} else {
							getCommodity();
						}
						myScroll.refresh();
						myScroll.options.snap = true;
					}, 100);
				}
			}, 120);
		}
		window.addEventListener("load", loaded, true);
		document.addEventListener('touchmove', function(e) {
			e.preventDefault();
		}, { passive: false });
		document.addEventListener('DOMContentLoaded', allowFormsInIscroll, false);

		function allowFormsInIscroll() {
			[].slice.call(document.querySelectorAll('input, select, button')).forEach(function(el) {
				el.addEventListener(('ontouchstart' in window) ? 'touchstart' : 'mousedown', function(e) {
					e.stopPropagation();
				})
			})
		}
	</script>

</html>